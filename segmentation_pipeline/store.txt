# for cellpose

command <<<
        index=0
        for value in "${image_path[@]}"; do
            python -m cellpose --image_path ${value} \
                                --pretrained_model ${model_type} \
                                --save_tif \
                                --save_txt \
                                --verbose \
                                --use_gpu \
                                --diameter ${diameter} \
                                --flow_threshold ${flow_thresh} \
                                --cellprob_threshold ${cell_prob_thresh} \
                                --chan ${segment_channel} \
                                --savedir "/cromwell_root/"  \
                                --no_npy
            
            # hack to change asap

            mv *_cp_masks.tif "imageout_${index}.tif"
            mv *_cp_outlines.txt "outlines_${index}.txt"   

            index = index + 1
        done
    >>>

# for transcripts per cell

for tuple in $(paste <(echo "$mask") <(echo "$detected_transcripts")); do
            mask_file=$(echo "$tuple" | cut -f1)
            detected_transcripts_file=$(echo "$tuple" | cut -f2)

            python /opt/mask_overlap.py \
                --mask "$mask_file" \
                --detected_transcripts "$detected_transcripts_file" \
                --transform "$transform_file"

            mv detected_transcripts_cellID.csv "detected_transcripts_cellID_$index.csv"
            mv detected_transcripts_cellID_geo.csv "detected_transcripts_cellID_geo_$index.csv"
            mv detected_transcripts_cellID_geo.parquet "detected_transcripts_cellID_geo_$index.parquet"
